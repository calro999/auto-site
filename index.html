<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAL-INTEL // ギャルの熱狂インテリジェンス</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* デザイン・レイアウトの完全復元 
           白・ピンク基調のポイ活・トレンドデザインを維持 
        */
        :root {
            --primary: #FF0080;
            --secondary: #7928CA;
            --bg-color: #f7f9fc;
            --card-bg: #ffffff;
            --text-main: #333333;
            --text-sub: #666666;
            --accent: #FF0080;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            margin: 0;
            padding-bottom: 100px;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 40px 20px;
            text-align: center;
            color: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 900;
            letter-spacing: -1px;
            /* 警告修正: 標準プロパティを追加 */
            background: linear-gradient(to right, #ffffff, #f0f0f0);
            -webkit-background-clip: text;
            background-clip: text; 
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }

        .last-update {
            font-size: 0.9rem;
            margin-top: 10px;
            opacity: 0.9;
        }

        main {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .trend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }

        /* --- カード反転アニメーション (本来のレイアウト) --- */
        .trend-card-container {
            perspective: 1000px;
            height: 480px;
        }

        .trend-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }

        .trend-card-container.flipped .trend-card-inner {
            transform: rotateY(180deg);
        }

        .front, .back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 20px;
            padding: 25px;
            background: var(--card-bg);
            box-shadow: 0 8px 25px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            border: 1px solid #eee;
        }

        .back {
            transform: rotateY(180deg);
            background: #fff;
            overflow-y: auto;
        }

        /* --- フロントデザイン --- */
        .vibes-memo {
            color: var(--primary);
            font-weight: bold;
            font-size: 0.85rem;
            background: #fff0f5;
            padding: 5px 12px;
            border-radius: 50px;
            align-self: flex-start;
            margin-bottom: 15px;
        }

        .trend-title {
            font-size: 1.4rem;
            font-weight: 800;
            line-height: 1.3;
            margin-bottom: 15px;
            color: #111;
            /* 警告修正: 標準プロパティを追加 */
            -webkit-background-clip: padding-box;
            background-clip: padding-box; 
        }

        .trend-desc {
            font-size: 0.95rem;
            color: var(--text-sub);
            line-height: 1.6;
            margin-bottom: 20px;
            flex-grow: 1;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .btn {
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.85rem;
            cursor: pointer;
            transition: 0.3s;
            border: none;
        }

        .btn-pink { background: var(--primary); color: white; }
        .btn-outline { border: 1px solid var(--secondary); color: var(--secondary); background: transparent; }
        .btn:hover { opacity: 0.8; transform: translateY(-2px); }

        /* --- バックデザイン --- */
        .ai-image-wrap {
            width: 100%;
            height: 180px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 15px;
            background: #f0f0f0;
        }

        .ai-image-wrap img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .summary-box {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid var(--secondary);
        }

        .summary-label {
            color: var(--secondary);
            font-weight: bold;
            font-size: 0.75rem;
            margin-bottom: 5px;
        }

        .summary-text {
            font-size: 0.9rem;
            color: #444;
            line-height: 1.5;
        }

        .btn-back {
            margin-top: 15px;
            background: #eee;
            color: #666;
        }

        footer {
            text-align: center;
            padding: 40px;
            color: #bbb;
            font-size: 0.8rem;
        }

        #loading {
            grid-column: 1 / -1;
            text-align: center;
            padding: 50px;
            color: var(--primary);
        }
    </style>
</head>
<body>

<header>
    <div class="logo">GAL-INTEL</div>
    <div id="last-update" class="last-update">CONNECTING...</div>
</header>

<main>
    <div id="trend-list" class="trend-grid">
        <div id="loading">
            <i class="fas fa-spinner fa-spin fa-2x"></i>
            <p style="margin-top:10px;">VIBE CHECKING...</p>
        </div>
    </div>
</main>

<footer>
    &copy; 2026 GAL-INTEL // ALL RIGHTS RESERVED.
</footer>

<script>
    // GitHubのリポジトリURL
    const DB_URL = "https://raw.githubusercontent.com/calro999/auto-site/main/intelligence_db.json";

    /**
     * 【究極の防衛関数】
     * 1文字化(配列化)バグを完全に防ぎ、データを安全に文字列として取り出す。
     */
    function safeExtract(input, max = 1000) {
        if (input === undefined || input === null) return "";
        let value = input;
        
        // 配列なら中身の1つ目を採用
        if (Array.isArray(value)) value = value[0];
        
        // オブジェクトなら中身の文字要素を探す
        if (typeof value === 'object') {
            value = value.title || value.text || JSON.stringify(value);
        }
        
        const str = String(value).trim();
        return str.length > max ? str.substring(0, max) + "..." : str;
    }

    async function load() {
        try {
            const response = await fetch(`${DB_URL}?t=${Date.now()}`);
            if (!response.ok) throw new Error("Load failed");
            const db = await response.json();

            document.getElementById('last-update').innerText = "LAST_SYNC: " + safeExtract(db.lastUpdate);
            
            const list = document.getElementById('trend-list');
            let content = "";

            if (!db.current || db.current.length === 0) {
                list.innerHTML = "<p style='grid-column:1/-1; text-align:center;'>No Data Available</p>";
                return;
            }

            db.current.forEach((item, index) => {
                const title = safeExtract(item.title, 80);
                const desc = safeExtract(item.desc, 200);
                const memo = safeExtract(item.memo, 50);
                const summary = safeExtract(item.aiSummary, 1000);
                const image = safeExtract(item.aiImage);
                const slug = safeExtract(item.slug);

                content += `
                <div class="trend-card-container" id="card-${index}">
                    <div class="trend-card-inner">
                        <div class="front">
                            <div class="vibes-memo">${memo}</div>
                            <div class="trend-title">${title}</div>
                            <div class="trend-desc">${desc}</div>
                            <div class="btn-group">
                                <a href="archive/${slug}.html" class="btn btn-pink">DETAILS</a>
                                <button class="btn btn-outline" onclick="flip(${index}, true)">VIBE</button>
                            </div>
                        </div>
                        <div class="back">
                            <div class="ai-image-wrap">
                                <img src="${image}" onerror="this.src='https://placehold.jp/24/eeeeee/666666/400x200.png?text=NO_IMAGE'">
                            </div>
                            <div class="summary-box">
                                <div class="summary-label"><i class="fas fa-robot"></i> AI INSIGHT</div>
                                <div class="summary-text">${summary}</div>
                            </div>
                            <button class="btn btn-back" onclick="flip(${index}, false)">BACK</button>
                        </div>
                    </div>
                </div>`;
            });
            list.innerHTML = content;
        } catch (err) {
            console.error(err);
            document.getElementById('trend-list').innerHTML = "SYSTEM ERROR";
        }
    }

    function flip(idx, isFlipped) {
        const card = document.getElementById(`card-${idx}`);
        if (isFlipped) card.classList.add('flipped');
        else card.classList.remove('flipped');
    }

    window.addEventListener('DOMContentLoaded', load);
</script>
</body>
</html>